<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ドアサーバー接続設定</title>
    <link rel="stylesheet" href="css/base.css">
    <script src="js/jquery-3.6.3.min.js"></script>
    <link rel="stylesheet" href="css/input.css">
    <script src="js/jquery.cookie-1.4.1.min.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/messages_ja.min.js"></script>
    <script src="js/additional-methods.min.js"></script>
</head>
<body><div id="userContainer">
    <h2>ドアサーバー接続設定</h2>
    <div class="marginGap">
            <span>
                値を入力し「確認」をクリックします。
            </span>
    </div>
    <div style="margin-top:15px;">
        変更を中止する場合は、「中止」をクリックしてください。
    </div>
</div>
<div style="width:650px;margin-left: auto;margin-right: auto;margin-top: 20px">
    <form action="/device/setServerControl">
    <div class="marginGap">
        <label for="command">
            コマンド
        </label>
        <input id="command" name="command" type="text" class="marginLeft" style="text-align: inherit;width: 200px;" required>
    </div>
    <div class="marginGap">
        <label for="ip">
            宛先IPアドレス
        </label>
        <input id="ip" name="serverIp" type="text" size="50" class="marginLeft" required style="width: 200px;">
    </div>
    <div class="marginGap">
        <label for="port">
            ボート番号
        </label>
        <input id="port" name="serverPort" type="text" class="marginLeft">
    </div>
    <div class="marginGap">
        <label for="timeout">
            タイムアウト「秒」
        </label>
        <input id="timeout" name="timeout" type="text" class="marginLeft">
    </div>
    <div class="marginGap">
        <label for="duration">
            解錠時間「秒」
        </label>
        <input id="duration" name="duration" type="text" class="marginLeft">
    </div>
    <div class="marginGap">
        <label>
            カード暗号化
        </label>
        <div  style="display:inline-block;">
            <input id="card" type="radio" name="cardEncrypt" value="0">
            <label for="card" class="radioLabel">
                無効
            </label>
        </div>
        <div  style="display:inline-block;">
            <input id="card2" name="cardEncrypt"  type="radio" value="1" >
            <label for="card2" class="radioLabel">
                有効
            </label>
        </div>
        <div class="marginGap hide">
            <label for="decryptKey">
                解読キー
            </label>
            <input id="decryptKey" name="decryptKey" type="text" class="marginLeft">
        </div>
        <div class="marginGap hide">
            <label for="decryptIv">
                解読IV
            </label>
            <input id="decryptIv" name="decryptIv" type="text" class="marginLeft">
        </div>
    </div>
    <div class="userSetDiv" style="margin-top: 70px;">
        <input id="" type="submit" class="userSetBtn" style="margin-right: 250px" value="確定" >
        <input id="stop" type="button" class="userSetBtn" value="中止" >
    </div>
    </form>
</div>
</body>

<script src="js/load.js"></script>
<script>
    $(".hide").hide();
    $("input[type='radio']").change(function () {
        if($(":checked").val()=="0"){
            $(".hide").hide();
        }else {
            $(".hide").show();
        }
    })


    function checkWithOnOff(value,pattern) {
        let $ctr = $(":checked");
        if ($ctr && $ctr.val() == "1"){
            return !!value && pattern.test(value);
        }
        return true;
    }

    jQuery.validator.addMethod("checkWithOnOff",function (value,element,pattern) {
        return this.optional(element) == true || checkWithOnOff(value,pattern);
    })

    $(function () {
        $("form").validate({
            rules: {
                serverIp:{
                    required:true,
                    // pattern:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/
                },
                serverPort:{
                    required: true,
                    // pattern:/^\d{1,5}$/
                    min:1,
                    max:65535
                },
                timeout:{
                    required: true,
                    // pattern:/^\d+$/
                    min:1,
                    max:60
                },
                duration:{
                    required: true,
                    // pattern:/^\d{1,5}$/
                    min:1,
                    max:99999
                },
                decryptKey:{
                    required:true,
                    // checkWithOnOff:/^[a-zA-Z0-9]{1,26}$/
                    pattern:/^[a-zA-Z0-9]{1,16}$/
                },
                decryptIv:{
                    required:true,
                    // checkWithOnOff:/^[a-zA-Z0-9]{1,26}$/
                    pattern:/^[a-zA-Z0-9]{1,16}$/
                },
            },
            messages: {
                serverIp:{
                    pattern: "正しく入力してください。"
                },
                serverPort:{
                    pattern: "数字で正しく入力してください。"
                },
                timeout:{
                    pattern: "数字で正しく入力してください。"
                },
                duration:{
                    pattern: "数字で正しく入力してください。"
                },
                decryptKey:{
                    pattern: "英数字16文字以内入力してください。"
                },
                decryptIv:{
                    pattern: "英数字16文字以内入力してください。"
                }
            },
            submitHandler: function (){
                ajaxSubmit();
                // alert("OK");
            }
        });
    })

</script>
</html>